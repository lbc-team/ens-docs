# Registrar
# 注册器

[源代码](https://github.com/ensdomains/ethregistrar/blob/master/contracts/BaseRegistrarImplementation.sol)

This contract implements the core functionality of the permanent registrar, with the following features:
本合约实现了永久注册器的核心功能，具有以下特点：

* The owner of the registrar may add and remove 'controllers'.
* Controllers may register new domains and extend the expiry of \(renew\) existing domains. They can not change the ownership or reduce the expiration time of existing domains.
* Name owners may transfer ownership to another address.
* Name owners may reclaim ownership in the ENS registry if they have lost it.
* Owners of names in the legacy registrar may transfer them to the new registrar, during the 1 year transition period. When they do so, their deposit is returned to them in its entirety.
* 注册器的所有者可添加或移除“管理员（controller）”。
* 管理员可以注册新域名和延长现有域名的有效期（即为域名续期），但不能更改现有域名的所有权或缩短其过期时间。
* 域名所有者可以将所有权转让给另一个地址。
* 如果域名所有者丢失了所有权，他们可以在ENS注册表中收回所有权。（译注：看到这句是不是有点蒙圈？因为精髓常常会有点难以理解！）
* 在1年过渡期内，旧版注册器的域名所有者可将其迁移至新版注册器。迁移域名时，会退还全部押金。

This section documents the parts of the registrar interface relevant to implementers of tools that interact with it. Functionality exclusive to the registrar owner or to controllers is omitted for brevity.
本节要讲的是与那些编写注册器交互工具的开发者息息相关的注册器接口部分。为简洁起见，省略了注册器所有者或管理员独有的功能。

The registrar works exclusively with label hashes - the `keccak256` of the first component of the label \(eg, `keccak256('ens')` for `ens.eth`\). For compatibility with ERC721, these are expressed as uint256 values rather than bytes32, but can be cast backwards and forwards transparently. The namehash of a name can be derived by computing `keccak256(baseNode, labelHash)`, where `basenode` is the namehash of the TLD the registrar manages - eg, `namehash('eth')`.
注册器只处理标签散列，确切地说是标签的第一个组件的`keccak256`值（比如，对`ens.eth`来说就是`keccak256('ens')`）。为了与ERC721兼容，这些值表示为uint256值，而非bytes32值，但是它们之间可以相互转换。通过计算`keccak256(baseNode, labelHash)`可以获得域名的namehash，其中的`baseNode`是注册器所管理的TLD的namehash，比如`namehash('eth')`。

Registrations and renewals are handled via the [controller](controller.md).
注册和续期是通过注册器的[管理员](controller.md)来处理的。

## Names and Registrations
## 域名和注册

All names inside ENS have an owner. The owner of a name can transfer the name to a new owner, set a resolver, and create and reassign subdomains. This functionality is all contained in the [ENS registry](../ens.md).
ENS中的每个域名都有一个所有者，域名所有者可以将域名转让给新所有者、设置解析器、创建和重新分配子域名，这些功能都包含在[ENS注册表](../ens.md)中。

Allocation of names directly under .eth \(eg, second-level domains ending with .eth, such as _alice.eth_\) is governed by the .eth Permanent Registrar, described here. While buying a name from the registrar grants ownership of it in ENS, the registrar itself keeps independent track of who owns the **registration**. The concept of a **registrant** - the owner of a registration - is unique to the .eth permanent registrar.
直接在.eth下分配的域名（例如，以.eth结尾的二级域名，如 _alice.eth_ ）是由前面所说.eth永久注册器管理的。当从注册器购买一个域名并合法获取该域名在ENS中的所有权时，注册器会自动跟踪谁拥有**注册**，即谁是注册人，这里的**注册人**的对.eth永久注册器来说是唯一的。（译注：这里提到的“注册”是个名词，可以理解为“注册证书”，注册证书代表了一个域名的“主权”，拥有这个注册证书的人就是这个域名的“注册人”，而注册人具有最高操作权限，可以操作域名的所有权。简而言之，注册人是一个域名的真正主人，而我们经常提到的所有者其实是这个域名的管理员。下面我们还会多次提到“注册”，切记它是一个名词，不妨将其自行脑补成“注册证书”。）

The registrant of a name can transfer the registration to another account, and they can recover ownership of the name by calling [reclaim](registrar.md#reclaim-ens-record), which resets ownership of the ENS name to the registrant's account.
域名的注册人可以将注册（权）转让给另一个帐户，拥有注册权可以通过调用[reclaim](registrar.md#reclaim-ens-record)来恢复域名的所有权，该方法将ENS域名的所有权重置到注册人的帐户。

Separating the concept of owning a name from owning a registration makes it possible to more easily build systems that make automated updates to ENS. The registrant can transfer ownership of the name to another account or to a smart contract that manages records, subdomains, etc, while still retaining the ability to recover ownership for upgrades, or in the case of a compromise.
将域名的所有权和注册权分离，易于构建对ENS进行自动更新的系统。注册人可以将名称的所有权转让给其他帐户或是一个用于管理记录、子域名等信息的智能合约，同时仍然保留着恢复所有权的能力，以便于进行版本升级或回退等操作。

When thinking about ownership, it's important to be clear whether you're considering ownership of the **name** or the **registration**.
当涉及所有权时，很重要的一点是要弄清楚您是在考虑**域名**的所有权还是**注册**的所有权。

## Read Operations
## 读取操作

### Get Name Expiry
### 获取域名到期时间

```text
function nameExpires(uint256 label) external view returns(uint);
```

Returns the unix timestamp at which a registration currently expires. Names that do not exist or are not yet migrated from the legacy registrar will return 0.
返回当前域名到期的unix时间戳，未注册的域名或是尚未从旧版注册器迁移的域名将返回0。

### Check Name Availability
### 检查域名的可用性

```text
function available(uint256 label) public view returns(bool);
```

Returns `true` if a name is available for registration. Takes into account not-yet-migrated registrations from the legacy registrar. Registrar controllers may impose more restrictions on registrations than this contract \(for example, a minimum name length\), so this function **should not** be used to check if a name can be registered by a user. To check if a name can be registered by a user, [check name availablility via the controller](controller.md#check-name-availability).
如果域名可以注册，则返回`true`。考虑到旧版注册器上那些尚未迁移的已注册域名，注册器的管理员可能会对域名注册增加一些超出注册器合约的限制条件（例如，最小域名长度），所以该函数**不应该**用于检查用户是否可以注册某个域名。要检查用户是否可以注册某个域名，应该[通过控制器检查域名的可用性](controller.md#check-name-availability)。

### Get Transfer Period End
### 获取迁移截止时间

```text
uint public transferPeriodEnds;
```

`transferPeriodEnds` documents the unix timestamp at which it is no longer possible to migrate over registrations from the legacy registrar, and any non-migrated registrations become available for registration by anyone.
`transferPeriodEnds`记录着一个unix的迁移截止时间戳，这个时间到达后，就不能再从旧版注册器进行注册迁移，且所有未迁移注册的域名都可以被重新注册。

### Get Controller Status
### 获取控制器状态

```text
mapping(address=>bool) public controllers;
```

`controllers` allows callers to check if the supplied address is authorized as a registrar controller.
`controllers`允许调用者检查某个地址是否被授权为注册器的控制器。

### Check Token Approval
### 检查域名授权

```text
function getApproved(uint256 tokenId) public view returns (address operator);
```

Returns the address of the approved operator for this name.

This function is part of ERC721.
返回该域名的委托操作员的地址。（译注：如果不理解这里的“委托”，请查阅有关以太坊approve操作的信息。）

这个函数是ERC721的一部分。

### Check All Tokens Approval
### 检查所有域名授权

```text
function isApprovedForAll(address owner, address operator) public view returns (bool);
```

Returns true if `operator` is authorized to transfer all tokens for `owner`.
如果`operator`得到了可以为`owner`转让所有域名的授权，则返回true。

This function is part of ERC721.
这个函数是ERC721的一部分。

### Get Name Owner
### 获取域名所有者

```text
function ownerOf(uint256 label) external view returns(address);
```

`ownerOf` returns the address that owns the registration identified by the label hash, or reverts if the registration does not exist. Registrations that have not yet been migrated from the legacy registrar are treated the same as registrations that do not exist.
`ownerOf`返回由标签的散列标识的注册的所有者的地址（译注：即返回注册人的地址），如果注册不存在则返回0。尚未从旧版注册器迁移的注册会被视为不存在的注册。

This function is part of [ERC721](https://github.com/ensdomains/ens/blob/master/docs/ethregistrar.rst#id7).
这个函数是[ERC721](https://github.com/ensdomains/ens/blob/master/docs/ethregistrar.rst#id7)的一部分。

## Write Operations
## 写入操作

### Transfer a Name
### 转让域名

```text
function transferFrom(address from, address to, uint256 tokenId) public;
function safeTransferFrom(address from, address to, uint256 tokenId) public;
function safeTransferFrom(address from, address to, uint256 tokenId, bytes memory data) public;
```

These functions transfer the registration.
以上函数转让的是注册（译注：即变更注册人）。

They behave as specified in [ERC721](https://github.com/ensdomains/ens/blob/master/docs/ethregistrar.rst#id9).
它们按照[ERC721](https://github.com/ensdomains/ens/blob/master/docs/ethregistrar.rst#id9)中的规定来执行。

Emits the following event on a successful transfer:
实现一次成功转让会触发以下事件：

```text
event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);
```

### Approve Operator
### 委托操作

```text
function approve(address to, uint256 tokenId) public;
function setApprovalForAll(address operator, bool _approved) public;
```

These functions manage approvals as documented in [ERC721](https://github.com/ensdomains/ens/blob/master/docs/ethregistrar.rst#id11).
[ERC721](https://github.com/ensdomains/ens/blob/master/docs/ethregistrar.rst#id11)中记录了这些用于委托管理的函数的信息。

### Reclaim ENS Record
### 收回ENS所有权

```text
function reclaim(uint256 label) external;
```

Sets the owner record of the name in the ENS registry to match the owner of the registration in this registry. May only be called by the owner of the registration.
将ENS注册表中域名所有者的记录设置为该域名注册的所有者，该函数只能由注册的所有者调用。（译注：一个域名的注册人可以通过调用该函数将域名的管理员地址设置为注册人的地址，也就是收回了域名的管理权。）

## Events
## 事件

### Name Migrated
### 域名迁移事件

```text
event NameMigrated(uint256 indexed hash, address indexed owner, uint expires);
```

This event is emitted when a name is migrated from the legacy registrar.
当域名从旧版注册器迁出时，会触发此事件。

### Name Registered
### 域名注册事件

```text
event NameRegistered(uint256 indexed hash, address indexed owner, uint expires);
```

This event is emitted when a controller registers a new name.
当一个管理员注册一个新域名时会触发此事件。

### Name Renewed
### 域名续期事件

```text
event NameRenewed(uint256 indexed hash, uint expires);
```

This event is emitted when a controller renews \(extends the registration of\) a name.
当一个管理员给一个域名续期（或注册）时会触发此事件。

### Transfer
### 转让事件

```text
event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);
```

This event is emitted when registration is transferred to a new owner. This is distinct from the [ENS Registry](../ens.md)'s Transfer event, which records transfers of ownership of the ENS record.
将注册转移到新所有者时会触发此事件。这与[ENS注册表](../ens.md)的转让事件不同，后者记录的是ENS的所有权转移。

